<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}"
	layout:fragment="content">
<meta charset="UTF-8">
<title>근태관리</title>
<style>
/* 전체 컨테이너를 세로 배치 */
.main-container {
	display: flex;
	width: 100%;
}

#card-left {
	width: 400px;
	height: 100vh;
	padding: 30px;
	margin: 30px;
	position: sticky;
	top: 0;
	flex-shrink: 0;
}

/* 오른쪽 컨테이너 (카드들을 세로 정렬) */
.right-container {
	display: flex;
	flex-direction: column;
	flex-grow: 1;
	padding: 20px;
}

#card-center, #card-right {
	width: 100%;
	padding: 30px;
	margin: 10px 0; /* 상하 간격 추가 */
	flex-grow: 1;
}

.date-box {
	font-size: 20px;
	margin-bottom: 10px;
}

.time-box {
	font-size: 40px;
	margin-bottom: 10px;
}

.content {
	flex: 1;
	padding: 20px;
}

table {
	width: 100%;
	border-collapse: collapse;
	margin-top: 20px;
}

.table-container {
	max-height: 300px;
	overflow-y: auto;
	border: 1px solid #ccc;
	display: block;
}

.dropdown-work {

	margin-top: 80px; 
}

.table-responsive {
	max-height: 400px; 
	overflow-y: auto;
}
</style>
</head>
<body>
	<div class="main-container">
		<div class="card" id="card-left">
			<div class="card-body">
				<h4 class="card-title">내 근태 현황</h4>
				<p class="date-box" id="current-date"></p>
				<p class="time-box" id="current-time"></p>				
				<p>	출근시간 : <span id="start-time" >[[${attend} != null ? ${#dates.format(attend.startWork, 'HH:mm')} : 미등록 ]]</span> </p>
				<p>	퇴근시간 : <span id="end-time">[[${attend} != null ? ${#dates.format(attend.afterWork, 'HH:mm')} : 미등록 ]]</span> </p>
				
				<form action="startWork" th:if ="${attend}== null">
					<button class="btn btn-primary btn-fw" id="workStart">출근하기</button>
				</form>
				<form action="afterWork" th:if="${attend} != null and ${attend.afterWork} == null">
					<input type="hidden" name="workNo" th:value="${attend.workNo}">
					<button class="btn btn-secondary btn-fw">퇴근하기</button>
				</form>
				<div class="dropdown-work" style="display: inline-flex; align-items: center; gap: 10px;">				
					<select id="work-type" class="form-select input-fixed">
						<option value="기본">근무타입선택</option>
						<option value="재택">재택</option>
						<option value="출장">출장</option>
						<option value="연차">연차</option>
					</select>
					<button onclick="applyWorkType()" class="btn btn-primary btn-fw">신청</button>				
				</div>
			</div>
		</div>

		<!-- 오른쪽 컨테이너 -->
		<div class="right-container">
			<div class="card" id="card-center">
				<div class="card-body">
					<!-- 내용 추가 -->
					<div class="col-12 col-sm-6 col-md-6 col-xl-3">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between">
                      <div>
                        <h6><b>Todays Income</b></h6>
                        <p class="text-muted">All Customs Value</p>
                      </div>
                      <h4 class="text-info fw-bold">$170</h4>
                    </div>
                    <div class="progress progress-sm">
                      <div class="progress-bar bg-info w-75" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between mt-2">
                      <p class="text-muted mb-0">Change</p>
                      <p class="text-muted mb-0">75%</p>
                    </div>
                  </div>
                </div>
              </div>
				</div>
			</div>
			<div class="card" id="card-right">
				<div class="card-body">
					<!-- 내용 추가 -->
					<div class="content">
					<h4 class="card-title">이번달 근태 현황</h4>							
					</div>						
						<div class="table-responsive">
							<table class="table">
								<thead>
									<tr>
										<th>날짜</th>
										<th>출근시간</th>
										<th>퇴근시간</th>
										<th>근무시간</th>
										<th>근무상태</th>
									</tr>
								</thead>
								<tbody>
									<!-- 단건 : 배열 -->
									<tr th:each="work : ${works}">
										<td>[[ ${#dates.format(work.startWork, 'yyyy/MM/dd')} ]]</td>
										<td>[[ ${#dates.format(work.startWork, 'HH:mm')} ]]</td>
										<td>[[ ${#dates.format(work.afterWork, 'HH:mm')} ]]</td>
										<td>[[ ${work.workTime} ]]</td>
										<td>[[ ${work.workStatus} ]]</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
<script>
 	//현재 시간 출력
	function currentDate() {
		const now = new Date();
		document.getElementById("current-date").innerText = now.toISOString()
				.split('T')[0];
		document.getElementById("current-time").innerText = now
				.toLocaleTimeString();
	}
	setInterval(currentDate, 1000);
	currentDate();
	
</script>
</html>