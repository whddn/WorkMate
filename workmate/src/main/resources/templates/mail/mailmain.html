<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/mail_layout}"
	layout:fragment="content">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë©”ì¼í•¨ | KaiAdmin Lite</title>
<style>
.w-25 {
	margin-left: 70%;
	padding-bottom: 10px;
}

.asd {
	padding-bottom: 10px;
}
</style>
</head>

<body>
	<div class="container mt-4">
		<h2 class="mb-4">ë°›ì€ ë©”ì¼í•¨</h2>
		<div class="input-group w-25">
			<input type="text" id="searchBox" class="form-control"
				placeholder="ê²€ìƒ‰...">
			<button class="btn btn-secondary" onclick="searchTable()">ê²€ìƒ‰</button>
		</div>
		<div class="card">
			<div class="card-body">
				<div class="asd">
					<button class="btn btn-danger btn-sm">ì‚­ì œ</button>
					<button class="btn btn-secondary btn-sm">ì´ë™</button>
				</div>
				<table id="mailTable" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th><input type="checkbox" id="selectAll"></th>
							<th>ë³´ë‚¸ ì‚¬ëŒ</th>
							<th>ì œëª©</th>
							<th>ì²¨ë¶€</th>
							<th>ë‚ ì§œ</th>
						</tr>
					</thead>
					<tbody id="mailBody">
						<tr
							th:if="${receivedMails == null or #lists.isEmpty(receivedMails)}">
							<td colspan="5" class="text-center">ë°›ì€ ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</td>
						</tr>

						<tr th:each="mail : ${receivedMails}" class="mail-row">
							<td><input type="checkbox" class="mail-checkbox"
								th:value="${mail.mailId}"></td>
							<td th:text="${mail.recipients}"></td>
							<td><a th:href="@{/mail/view(mailId=${mail.mailId})}"
								th:text="${mail.subject}"></a></td>
							<td th:if="${mail.attachmentCount > 0}">ğŸ“</td>
							<td th:if="${mail.attachmentCount == 0}"></td>
							<td th:text="${#dates.format(mail.sentAt, 'yyyy-MM-dd HH:mm')}"></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const selectAllCheckbox = document.getElementById("selectAll");
        const checkboxes = document.querySelectorAll(".mail-checkbox");

        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ ëª¨ë“  ì²´í¬ë°•ìŠ¤ ì„ íƒ/í•´ì œ
        selectAllCheckbox.addEventListener("change", function() {
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });

        // ê°œë³„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³€ê²½ ì‹œ ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì¡°ì •
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener("change", function() {
                selectAllCheckbox.checked = [...checkboxes].every(cb => cb.checked);
            });
        });
    });
    //ê²€ìƒ‰
    function searchTable() {
        let input = document.getElementById("searchBox").value.toLowerCase();
        let rows = document.querySelectorAll("#mailBody .mail-row");

        rows.forEach(row => {
            let recipient = row.cells[1].textContent.toLowerCase(); // ë³´ë‚¸ ì‚¬ëŒ
            let subject = row.cells[2].textContent.toLowerCase(); // ì œëª©

            if (recipient.includes(input) || subject.includes(input)) {
                row.style.display = ""; // ê²€ìƒ‰ì–´ê°€ í¬í•¨ëœ í–‰ í‘œì‹œ
            } else {
                row.style.display = "none"; // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ìˆ¨ê¹€
            }
        });
    }
</script>
</html>