<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/commonItem_layout}"
	layout:fragment="content">
<head>
<meta charset="UTF-8">
<title>ê³µìš©í’ˆ ê´€ë¦¬ ë“±ë¡</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
body {
	font-family: Arial, sans-serif;
	background-color: #f4f4f4;
}

.container {
	width: 50%;
	background: white;
	padding: 20px;
	border-radius: 10px;
	box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
	margin-top: 100px;
}

h2 {
	text-align: center;
}

.form-group {
	margin-bottom: 15px;
}

label {
	font-weight: bold;
}

select, input, button {
	padding: 8px;
	margin-top: 5px;
}

.time-group {
	display: flex;
	gap: 10px;
	align-items: center;
}

.btn-save {
	background-color: #007bff;
	color: white;
}

.btn-cancel {
	background-color: #ccc;
}
</style>
</head>
<body>
	<div class="container">
		<h2>ê³µìš©í’ˆ ê´€ë¦¬ ìˆ˜ì •</h2>
		<form name="updateForm" th:object="${update}" enctype="multipart/form-data">
		<input type="hidden" class="common-no" th:field="*{commonNo}" >
			<div class="form-group">
				<label>ê³µìš©í’ˆ ì¢…ë¥˜</label> <select th:field="*{commonKind}">
					<option value="íšŒì˜ì‹¤">íšŒì˜ì‹¤</option>
					<option value="ì°¨ëŸ‰">ì°¨ëŸ‰</option>
				</select>
			</div>

			<div class="form-group">
				<label>ì´ë¦„</label> <input type="text" placeholder="ì´ë¦„ ì…ë ¥" th:field="*{name}">
			</div>

			<div class="form-group">
				<label>ì„¤ëª…</label>
				<textarea  placeholder="í•­ëª© ì…ë ¥" rows="4" th:field="*{content}"></textarea>
			</div>

			<div class="form-group">
				<label>ì‹œê°„ ì¶”ê°€</label>
				<div class="time-group">
					<input type="time" th:field="*{reserStartTime}">
					 ~ <input type="time" th:field="*{reserEndTime}">
				</div>
			</div>

			<div class="form-group">
				<label>ì´ë¯¸ì§€ ì¶”ê°€</label>
				 <input type="file" name="itemImage" accept="image/*" id="item-image" >
			</div>

			<div class="form-group">
				<button type="button" class="btn btn-save" onclick="updateItem()">ìˆ˜ì •</button>
				<button type="button" class="btn btn-cancel" onclick="cancelForm()">ì·¨ì†Œ</button>
			</div>
		</form>
	</div>

	<script>
		function cancelForm() {
		    if (confirm("ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì…ë ¥í•œ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.")) {
		        window.location.href = `${contextPath}/admin/commonItemList`; // ğŸš€ ì»¨í…ìŠ¤íŠ¸ ê²½ë¡œ ì¶”ê°€
		    }
		}
	
		function updateItem() {
		    if (confirm("ê³µìš©í’ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")) {
		        window.location.href = `${contextPath}/admin/commonItemList`; // ğŸš€ ì»¨í…ìŠ¤íŠ¸ ê²½ë¡œ ì¶”ê°€
		    }
		}
        
        document.querySelector('form[name="updateForm"] button.btn-save').addEventListener('click', updateAjax);
        
        const metaTag = document.querySelector('meta[name="contextPath"]');
        const context = metaTag ? metaTag.getAttribute('value') : '';
        
        function updateAjax(event) {
            let formElement = document.querySelector('form[name="updateForm"]');
            if (!formElement) {
                console.error("í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            let formData = new FormData(formElement); // FormData ê°ì²´ ì‚¬ìš©

            fetch(`commonItemUpdate`, {
                method: 'POST',
                body: formData, // JSON.stringify() ëŒ€ì‹  FormData ì§ì ‘ ì „ë‹¬
            })
            .then(res => res.json())
            .then(data => {
                if (data.result) {
                    alert(`${data.target.name}ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤`);
                    window.location.href = `commonItemList`;
                } else {
                    alert('ìˆ˜ì •í•œê²Œ ì—†ìŠµë‹ˆë‹¤.');
                }
            })
            .catch(err => console.log(err));
        }

	        function getFormData() {
	            let formElement = document.querySelector('form[name="updateForm"]');
	            if (!formElement) {
	                console.error("í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
	                return null;
	            }
	
	            return new FormData(formElement); // FormData ê°ì²´ ê·¸ëŒ€ë¡œ ë°˜í™˜
	        }

        
    </script>
</body>
</html>
