<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/contracts_layout}"
      layout:fragment="content">
<head>
  <meta charset="UTF-8">
  <title>ê±°ë˜ì²˜ ê³„ì•½ì„œ ì‘ì„±</title>
  <style>
    .contract-table th {
      background-color: #f0f0f0;
      text-align: center;
      vertical-align: middle;
    }
    .contract-table input,
    .contract-table textarea {
      width: 100%;
      border: none;
      border-bottom: 1px solid #aaa;
      outline: none;
    }
    #signatureCanvas {
      border: 1px solid #ccc;
      width: 100%;
      height: 200px;
      touch-action: none;
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-4 text-center">ğŸ“ ê±°ë˜ì²˜ ê³„ì•½ì„œ ì‘ì„±</h2>
  <form id="tradeContractForm" method="post" th:action="@{/contracts/submit}" enctype="multipart/form-data">
    <table class="table table-bordered contract-table">
      <tr><th colspan="4">ê¸°ë³¸ ì •ë³´</th></tr>
      <tr>
        <th style="width: 20%">ê³„ì•½ëª…</th>
        <td colspan="3"><input type="text" name="contrTitle"></td>
      </tr>
      <tr>
        <th>ê³„ì•½ì¼ì</th>
        <td colspan="3"><input type="date" name="createDate"></td>
      </tr>
      <tr>
        <th>ê³„ì•½ ê¸°ê°„</th>
        <td colspan="3">
          <input type="date" name="contrStart" style="width: 45%; display: inline-block"> ~
          <input type="date" name="contrEnd" style="width: 45%; display: inline-block">
        </td>
      </tr>

      <tr><th colspan="4">ê±°ë˜ì²˜ ì •ë³´</th></tr>
      <tr>
        <th>ê±°ë˜ì²˜ëª…</th>
        <td colspan="3"><input type="text" name="contrB"></td>
      </tr>
      <tr>
        <th>ì—°ë½ì²˜</th>
        <td><input type="text" name="contrMoney"></td>
      </tr>
      <tr>
        <th>ì£¼ì†Œ</th>
        <td colspan="3"><input type="text" name="cntrLocation"></td>
      </tr>

      <tr><th colspan="4">ê³„ì•½ ë‚´ìš©</th></tr>
      <tr>
        <td colspan="4">
          <textarea name="contrContent" rows="6" placeholder="ê³„ì•½ ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
        </td>
      </tr>
      <tr>
        <th>ì²¨ë¶€íŒŒì¼</th>
        <td colspan="3"><input type="file" name="attachment"></td>
      </tr>

	      <tr><th colspan="4">ëŒ€í‘œì ë° ì„œëª…</th></tr>
	<tr>
	  <!-- ëŒ€í‘œì ì…ë ¥ (ì™¼ìª½ 50%) -->
	  <td style="width: 50%; vertical-align: top;">
	    <label><strong>ëŒ€í‘œì</strong></label>
	    <input type="text" name="contrA">
	  </td>
	  
	  <!-- ì„œëª… ìº”ë²„ìŠ¤ (ì˜¤ë¥¸ìª½ 50%) -->
	  <td colspan="3" style="width: 50%; vertical-align: top;">
	    <label><strong>ì„œëª…</strong></label>
	    <canvas id="signatureCanvas"></canvas>
	    <input type="hidden" name="signatureImage" id="signatureImage">
	    <button type="button" class="btn btn-sm btn-secondary mt-2" onclick="clearSignature()">ì„œëª… ì´ˆê¸°í™”</button>
	  </td>
	</tr>

    </table>

    <div class="d-flex justify-content-end mt-3">
      <button type="submit" class="btn btn-success">ë“±ë¡</button>
    </div>
  </form>
</div>

<script>
  const canvas = document.getElementById("signatureCanvas");
  const ctx = canvas.getContext("2d");
  let drawing = false;

  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;

  canvas.addEventListener("mousedown", startDraw);
  canvas.addEventListener("mousemove", draw);
  canvas.addEventListener("mouseup", endDraw);
  canvas.addEventListener("mouseleave", endDraw);

  function startDraw(e) {
    drawing = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
  }

  function draw(e) {
    if (!drawing) return;
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
  }

  function endDraw() {
    drawing = false;
  }

  function clearSignature() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById("signatureImage").value = "";
  }

  function saveSignature() {
    const dataURL = canvas.toDataURL("image/png");
    document.getElementById("signatureImage").value = dataURL;
  }
</script>
</body>
</html>
