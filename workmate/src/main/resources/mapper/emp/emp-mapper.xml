<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.workmate.app.employee.mapper.EmpMapper">
	<!-- 사원 전체 조회 (조직도/사원이름/부서명) -->
	<select id="selectAllName" resultType="EmpVO">
 		SELECT u.user_name
 				, u.user_no
		        , d.department_name
		FROM employee u 
		JOIN  team t 
		ON u.team_no = t.team_no
		JOIN department d 
		ON d.department_id = t.department_id 
	</select>
	<!--/* 사원 상세 조회 */-->
	<select id="selectOneEmp" resultType="EmpVO">
		SELECT u.user_name
		        , d.department_name
		        , t.team_name
                , u.team_no
		        , u.user_position
		        , u.user_no
		        , u.user_id
		        , u.hire_date
		        , u.resign_date
		        , u.user_phone
		        , u.address
		        , u.user_ip
		        , u.common_ip
		FROM employee u 
		JOIN team t 
		ON u.team_no = t.team_no
        JOIN department d 
		ON t.department_id = d.department_id
		WHERE u.user_no = #{userNo}
		AND u.user_no between 100 AND 300
	</select>
	
	<!-- 팀명 조회 -->
	<select id="selectAllEmpTeam" resultType="EmpVO">
		SELECT   team_no 
        	   , team_name
		FROM team
		ORDER BY team_no
	</select>
	
	<!-- 직급 조회 -->
	<select id="selectAllPosition" resultType="EmpVO">
		SELECT code_name
			, code
		FROM common_code
		WHERE group_code = '0Q' 
		AND code IS NOT NULL
	</select>
	
	<!-- 사원 등록 --> 
	<insert id="insertOneEmp" parameterType="EmpVO">
		<selectKey keyProperty="userNo"
				   resultType="Integer"
				   order="BEFORE">
		 SELECT MAX(USER_NO) + 1
         FROM EMPLOYEE
         WHERE USER_NO BETWEEN 200 AND 700
		</selectKey>
		INSERT INTO employee 
					(
    					 USER_NO
                       , USER_NAME
    				   , TEAM_NO
    				   , USER_POSITION
    				   , USER_ID
    				   , USER_PWD
    				   , USER_PHONE
    				   , ADDRESS
					) 
		VALUES 		
					(
						#{userNo}
                      , #{userName}
					  , #{teamNo}
					  , #{userPosition}
					  , 'user' || #{userNo}
					  , DBMS_RANDOM.STRING('X', 10) 
					  , #{userPhone}
					  , #{address}
					)
	</insert>
</mapper>