<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.workmate.app.approval.mapper.ApprElmntMapper">
	<select id="selectApprElmntList" parameterType="ApprovalVO" resultType="ApprElmntVO">
		SELECT apprelmnt_no
		    , appr_result
		    , appr_reason
		    , appr_date
		    , user_name
		    , team_name
		    , department_name
		FROM appr_elmnt
		    JOIN employee
		    ON appr_elmnt.approver=employee.user_no
		    LEFT JOIN team
		    ON employee.team_no=team.team_no
		    LEFT JOIN department
		    ON appr_elmnt.dept_no=department.department_id
		WHERE appr_no=#{apprNo}
	</select>
	<insert id="insertApprElmnt" parameterType="ApprElmntVO">
		<selectKey keyProperty="apprelmntNo" resultType="Integer" order="BEFORE">
			SELECT COUNT(appr_no) + 1
			FROM approval
		</selectKey>
		INSERT INTO appr_elmnt
		VALUES(#{apprelmntNo}
			, 'a1'
			, null
			, null
			, null
			, #{approver}
			, #{deptNo}
			, #{apprNo}
		)
	</insert>
</mapper>